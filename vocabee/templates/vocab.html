{% extends 'base.html' %}
{% set active_page = "vocab" %}

{% block container %}
    <title>N{{ level }} level words - Vocabee</title>
    <!--Stylesheets -->
    <link href="{{ url_for('static', filename='css/pages/vocab.css') }}" rel="stylesheet">

    <div class="container-fluid">
        <h1>N{{ level }} level vocabulary</h1>
        {% if level == 5 %}
            <p>This is the starting point of the JLPT, marking your first journey into the Japanese language.</p>
            <p>Reading: One is able to read and understand typical expressions and sentences written in hiragana,
                katakana, and basic kanji.<br>
                Listening: One is able to listen and comprehend conversations about topics regularly encountered in
                daily life and classroom situations, and is able to pick up necessary information from short
                conversations spoken slowly.</p>
        {% elif level == 4 %}
            <p>You're slowly getting more familiar with the Japanese language, and starting to move beyond basic
                concepts.</p>
            <p>Reading: One is able to read and understand passages on familiar daily topics written in basic vocabulary
                and kanji.<br>
                Listening: One is able to listen and comprehend conversations encountered in daily life and generally
                follow their contents, provided that they are spoken slowly.</p>
        {% elif level == 3 %}
            <p>You've now completely mastered the basics of Japanese, and can grasp the language in common
                situations.</p>
            <p>Reading: One is able to read and understand written materials with specific contents concerning everyday
                topics, grasp summary information of newspaper headlines and comprehend the context of difficult topics.<br>
                Listening: One is able to listen and comprehend coherent conversations in everyday situations, spoken at
                near-natural speed, and is generally able to follow their contents as well as grasp the relationships
                among the people involved.</p>
        {% elif level == 2 %}
            <p>You're slowly becoming very proficient in the language. In addition to grasping common situations, you
                can now partly comprehend more uncommon occurences. </p>
            <p>Reading: One is able to read materials written clearly on a variety of topics, such as articles and
                commentaries in newspapers and magazines as well as simple critiques, and comprehend their contents. One
                is also able to read written materials on general topics and follow their narratives as well as
                understand the intent of the writers.<br>
                Listening: One is able to comprehend orally presented materials such as coherent conversations and news
                reports, spoken at nearly natural speed in everyday situations as well as in a variety of settings, and
                is able to follow their ideas and comprehend their contents. One is also able to understand the
                relationships among the people involved and the essential points of the presented materials..</p>
        {% elif level == 1 %}
            <p>At this level you're considered a near native as far as reading and listening goes, and you make do in a
                variety of situations.</p>
            <p>Reading: One is able to read writings with logical complexity and/or abstract writings on a variety of
                topics, such as newspaper editorials and critiques, and comprehend both their structures and
                contents. One is also able to read written materials with profound contents on various topics and follow
                their narratives as well as understand the intent of the writers comprehensively.<br>
                Listening: One is able to comprehend orally presented materials such as coherent conversations, news
                reports, and lectures, spoken at natural speed in a broad variety of settings, and is able to follow
                their ideas and comprehend their contents comprehensively. One is also able to understand the details of
                the presented materials such as the relationships among the people involved, the logical structures, and
                the essential points.</p>
        {% endif %}
    </div>

    <div class="container-fluid" id="vocab-table-container">
        <table class="table table-striped table-hover" id="vocab-table" style="width: 100%;"></table>
    </div>

    <script type="text/javascript">
        // Initialize vocabulary entries
        let vocab = {{ vocab | safe }};
        let entries = vocab.entries;

        $(document).ready(function () {
            $('#vocab-table').DataTable({
                data: entries,
                pageLength: 8,
                columns: [
                    {title: "ID"},
                    {title: "Kanji"},
                    {title: "Hiragana"},
                    {title: "English"},
                    {
                        title: "Examples",
                        orderable: false,
                        searchable: false,
                        render: function () {
                            return '<button ' +
                                'type="button" ' +
                                'class="btn btn-outline-primary" ' +
                                'id="example-select" ' +
                                'data-toggle="modal" ' +
                                'data-target="#vocab-modal">Show</button>\n'
                        }
                    }
                ],
                responsive: true
            });
        });

        $("#vocab-table").on('click', '#example-select', function (e) {
            // Get data from all rows, including hidden ones. Ref: https://stackoverflow.com/a/38515622
            e.preventDefault();
            let current_row = $(this).parents('tr');
            if (current_row.hasClass('child')) {
                current_row = current_row.prev();
            }
            let row_data = $('#vocab-table').DataTable().row(current_row).data();
            let vocab_id = row_data[0];

            // Retrieving the example data
            let endpoint = "/vocab/example/" + vocab_id;
            $.ajax({
                type: "GET",
                contentType: "vocabee/json; charset=utf-8",
                url: endpoint,
                success: function (result) {
                    result = $.parseJSON(result);

                    // Append content to modal body
                    let modal_content = document.getElementById("vocab-modal-body");
                    modal_content.innerHTML = '';
                    let example_count = result.length;
                    if (example_count > 0) {
                        for (let e of result) {
                            let paragraph = document.createElement("p");
                            paragraph.innerHTML = `${e[1]}<br>${e[2]}<br>`;
                            modal_content.appendChild(paragraph);
                        }
                    } else {
                        let paragraph = document.createElement("p");
                        paragraph.innerHTML = `Sorry, no examples for this entry...`;
                        modal_content.appendChild(paragraph);
                    }

                    // Set modal title
                    let modal_title = document.getElementById("modalLargeLabel");
                    let example_text = "examples";
                    if (example_count === 1) {
                        example_text = "example";
                    }

                    // Ref: https://stackoverflow.com/questions/7864723#7864740
                    let kanji = row_data[1].split(/<a[^>]*>([\s\S]*?)<\/a>/)[1];
                    let hiragana = row_data[2].split(/<a[^>]*>([\s\S]*?)<\/a>/)[1];
                    if (typeof kanji !== 'undefined') {
                        modal_title.textContent = `Showing ${example_count} ${example_text} for ${kanji}/${hiragana}`;
                    } else {
                        modal_title.textContent = `Showing ${example_count} ${example_text} for ${hiragana}`;
                    }
                }
            });
        })
    </script>

    <div class="modal fade modal-fullscreen" id="vocab-modal" tabindex="-1" role="dialog"
         aria-labelledby="modalLargeLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLargeLabel">Examples</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="vocab-modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}