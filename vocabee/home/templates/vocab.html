{% extends 'base.html' %}
{% set active_page = "vocab" %}

{% block container %}
    <title>N{{ level }} vocabulary - VocaBee</title>
    <!--Stylesheets -->
    <link href="{{ url_for('home.static', filename='css/pages/vocab.css') }}" rel="stylesheet">
    <script src="{{ url_for('home.static', filename='js/tables.js') }}"></script>
    <script src="{{ url_for('home.static', filename='js/artyom.window.min.js') }}"></script>
    <!--Ref: https://datatables.net/ -->
    <!--Ref: Option 1 - Bootstrap / Option 2 DataTables / Option 3 Responsive) -->
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/bs4/dt-1.10.20/r-2.2.3/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.20/r-2.2.3/datatables.min.js"></script>


    <div class="container-fluid text-container">
        <a href="{{ url_for('home.vocab_index') }}" title="Go back">
            <i class="float-left material-icons md-30" id="back-button">arrow_back</i>
        </a>
        <p class="smalltext">Back to vocabulary page</p>

        <div class="text-container">
            <h1 class="">N{{ level }} level vocabulary</h1>
            {% if level == 5 %}
                <p>This is the starting point of the JLPT, marking your first journey into the Japanese language. You
                    should
                    be able to read and understand basic expressions, and be able to listen and comprehend common
                    topics,
                    provided they're short and spoken slowly.</p>
            {% elif level == 4 %}
                <p>You're slowly getting more familiar with the Japanese language, and starting to move beyond basic
                    concepts. You can now read and understand items written with basic vocabulary, and comprehend
                    conversation about daily life, provided they're not spoken too quickly.</p>
            {% elif level == 3 %}
                <p>You've now mastered the basics of Japanese, and can grasp the language in common situations. You can
                    grasp contents concerning daily topics, recognize summary information from newspaper articles and
                    understand
                    the context of more diffult topics.</p>
            {% elif level == 2 %}
                <p>You're slowly becoming very proficient in the language. In addition to grasping common occurences,
                    you
                    can now partly comprehend more difficult situations. You can read and understand materials written
                    in a
                    variety of topics along with the intent of the writers, and follow coherent conversations spoken at
                    natural speed. </p>
            {% elif level == 1 %}
                <p>At this level you're considered a near native as far as reading and listening goes, and you can make
                    do
                    in a variety of situations. You can read writings with logical complexity/of abstract nature and
                    comprehend conversations spoken at natural speed about a wide variety of topics.</p>
            {% endif %}
        </div>
    </div>

    <div class="container-fluid" id="vocab-table-container">
        <table class="table table-striped table-hover" id="vocab-table"></table>
    </div>

    <div class="modal fade modal-fullscreen" id="vocab-modal" tabindex="-1" role="dialog"
         aria-labelledby="modalLargeLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLargeLabel">Examples</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="vocab-modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // TODO: move all of this to a file
        // Initialize vocabulary table
        let vocab = {{ vocab | safe }};
        let entries = vocab.entries;

        const artyom = new Artyom();
        artyom.initialize({
            lang: "jp-JP",
            debug: false,
            continuous: false,
            speed: 0.55
        });

        $(document).ready(function () {
            createVocabTable(entries);
        });

        $("#vocab-table").on('click', '.example-select', function (e) {
            // Get data from all rows, including hidden ones. Ref: https://stackoverflow.com/a/38515622
            e.preventDefault();
            let current_row = $(this).parents('tr');
            if (current_row.hasClass('child')) {
                current_row = current_row.prev();
            }
            let row_data = $('#vocab-table').DataTable().row(current_row).data();
            let vocab_id = row_data[0];
            // Ref: https://stackoverflow.com/questions/7864723#7864740
            let kanji = row_data[1].split(/<a[^>]*>([\s\S]*?)<\/a>/)[1];
            let hiragana = row_data[2].split(/<a[^>]*>([\s\S]*?)<\/a>/)[1];

            // Retrieving example data
            let endpoint = "/vocab/example/" + vocab_id;
            $.ajax({
                type: "GET",
                contentType: "vocabee/json; charset=utf-8",
                url: endpoint,
                success: function (result) {
                    let exampleData = $.parseJSON(result);
                    fillExampleModal(exampleData, kanji, hiragana);
                }
            });
        });

        $("#vocab-table").on('click', '.pronounciation_button', function (e) {
            e.preventDefault();
            let current_row = $(this).parents('tr');
            if (current_row.hasClass('child')) {
                current_row = current_row.prev();
            }
            let row_data = $('#vocab-table').DataTable().row(current_row).data();
            // Ref: https://stackoverflow.com/questions/7864723#7864740
            let hiragana = row_data[2].split(/<a[^>]*>([\s\S]*?)<\/a>/)[1];
            artyom.say(hiragana);
        });
    </script>
{% endblock %}